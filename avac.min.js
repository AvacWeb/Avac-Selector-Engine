/* 
* Avac CSS Selector Engine. 
* Created by LGforum @ AvacWeb (avacweb.com)
* AvacWeb Copyright 2011-2012
* All Right Reserved.
* No unauthorized distrubution or copying.
*/

(function(){window.$avac=function(j,f,k){if(j&&!(""==j||" "==j)){-1!=j.indexOf("#")&&(j=j.substring(j.lastIndexOf("#")));if(f){"string"===typeof f&&(f=$avac(f));var m="object"===typeof f?"concat"in f?f:"tagName"in f?[f]:Array.prototype.slice.call(f):[document]}else m=[document];var h=j.match(/(?:#[^\>\+\.\s\[:]+)|(?:\.[^\>\+\.\s\[:]+)|(?:\[\w+(?:[\$\*\^!]?=["'][\w\s]+["'])?\])|(?:[\>\+])|\w+|\s|(?::[\w-]+)/g),d=this,f=!0,l=m,i=[],o;if(document.querySelectorAll){for(var k=[],f=0,q=m.length;f<q;f++)k= k.concat(Array.prototype.slice.call(m[f].querySelectorAll(j)));return k}o=k&&3==k.length?["sibling","child",k[0],k[1],k[2],"pseudo"]:"child,sibling,class,tag,pseudo,attr".split(",");this.possibles={id:/^#[^\>\+\.\s\[:]+$/,"class":/^\.[^\>\+\.\s\[:]+$/,tag:/^[^\>\+\.\s\[:="']+$/,child:/^\>$/,attr:/^(?:\[\w+(?:[\$\*\^!]?=["'][\w\s]+["'])?\])$/,sibling:/^\+$/,pseudo:/^:(?:first|last|only(?:-of-type|-child))|empty|not\(.*\)$/};this.identify=function(a){for(var b in d.possibles)if(d.possibles[b].test(a))return b; return!1};this.byClass=function(a,b){if(a.getElementsByClassName)return Array.prototype.slice.call(a.getElementsByClassName(b));for(var c=a.getElementsByTagName("*"),g=[],r=RegExp("(^|\\s)"+b+"(\\s|$)"),d=0,e=c.length;d<e;d++)r.test(c[d].className)&&g.push(c[d]);return g};this.byAttr=function(a,b,c){for(var g=[],d=a.all?a.all:a.getElementsByTagName("*"),e=b.value,b=b.name,d="href"===b?a.getElementsByTagName("a"):"name"===b?a.getElementsByName?e?a.getElementsByName(e):d:d:d,a=0,e=d.length;a<e;a++){var f= d[a].getAttribute(b);f&&c(f)&&g.push(d[a])}return g};this.attrParse=function(a){var a=a.replace(/^\[/,"").replace(/\]$/,""),b=a.match(/^\w+/)[0],c=!1,g=!1;/^\w+[\$\^\*!]?=/.test(a)&&(c=a.match(/[\^\$\*!]?=/)[0],g=a.substring(a.indexOf(c)+c.length),g=g.replace(/^['"]/,"").replace(/['"]$/,""));return{name:b,condition:c,value:g}};this.getAttrFn=function(a){return"="===a.condition?function(b){return b===a.value}:"^="===a.condition?function(b){return 0===b.indexOf(a.value)}:"$="===a.condition?function(b){return RegExp(a.value+ "$").test(b)}:"*="===a.condition?function(b){return-1!=b.indexOf(a.value)}:"!="===a.condition?function(b){return b!=a.value}:function(){return!1}};this.get={id:function(a,b){var c=b.substr(1);return[document.getElementById(c)]},"class":function(a,b){var c=b.substr(1);return d.byClass(a,c)},tag:function(a,b){return Array.prototype.slice.call(a.getElementsByTagName(b))},attr:function(a,b){var c=d.attrParse(b),g;g=c.condition&&c.value?g=d.getAttrFn(c):g=function(){return!0};return d.byAttr(a,c,g)},child:function(a){return a.firstChild? Array.prototype.slice.call(a.childNodes):[]},sibling:function(a){for(;a=a.nextSibling;)if(1==a.nodeType)return[a];return[]},pseudo:function(a,b){b=b.substr(1);return d.pseudo_get[b](a)}};this.context_loop=function(a){for(var b=m,c=m.length,g=[],d=0;d<c;d++)1!=b[d].nodeType&&9!=b[d].nodeType||(g=g.concat(a(b[d])));return g};this.filter_function=function(a){for(var b=l,c=[],d=b.length,e=0,d=b.length;e<d;e++)1!=b[e].nodeType&&9!=b[e].nodeType||a(b[e])&&c.push(b[e]);return c};this.filter={"class":function(a){var b= RegExp("(^|\\s)"+a.substr(1)+"(\\s|$)");return d.filter_function(function(a){return b.test(a.className)})},tag:function(a){return d.filter_function(function(b){return b.tagName.toLowerCase()===a.toLowerCase()})},attr:function(a){var b=d.attrParse(a),c;c=b.condition&&b.value?c=d.getAttrFn(b):function(){return!0};return d.filter_function(function(a){return a.getAttribute(b.name)?c(a.getAttribute(b.name)):!1})},sibling:function(){return d.filter_function(function(a){for(a=a.previousSibling;a&&1!=a.nodeType;)a= a.previousSibling;return-1!=l.indexOf(a)})},pseudo:function(a){a=a.substr(1);return d.filter_function(function(b){return d.pseudo_filter[a](b)})}};this.pseudo_filter={"first-child":function(a){for(;a=a.previousSibling;)if(1==a.nodeType)return!1;return!0},"last-child":function(a){for(;a=a.nextSibling;)if(1==a.nodeType)return!1;return!0},"only-child":function(a){for(var b=a.parentNode.childNodes,c=0,d=b.length;c<d;c++)if(1==b[c].nodeType&&b[c]!=a)return!1;return!0}};this.pseudo_get={"first-child":function(a){for(var a= a.all?a.all:a.getElementsByTagName("*"),b=[],c=0,e=a.length;c<e;c++)d.pseudo_filter["first-child"](a[c])&&b.push(a[c]);return b},"last-child":function(a){for(var a=a.all?a.all:a.getElementsByTagName("*"),b=[],c=0,e=a.length;c<e;c++)d.pseudo_filter["last-child"](a[c])&&b.push(a[c]);return b},"only-child":function(a){for(var a=a.all?a.all:a.getElementsByTagName("*"),b=[],c=0,e=a.length;c<e;c++)d.pseudo_filter["only-child"](a[c])&&b.push(a[c]);return b}};var p=this.identify(j);if(p)return this.context_loop(function(a){return this.get[p](a, j)});this.multiToken=function(){for(var a=[],b,c=0,e=o.length;c<e;c++)for(;-1!=i.indexOf(o[c],1);)b=i.indexOf(o[c],1),a.push(i[b-1]),a.push(i[b]),i[b]=i[b]=null;l=d.context_loop(function(b){return d.get[a[1]](b,a[0])});b=2;for(c=a.length;b<c;b++)e=a[b],b++,l=this.filter[a[b]](e);m=l};for(var e=0,k=h.length;e<k;e++)if(m=l," "==h[e])f=!0;else{var n=this.identify(h[e]);if(!n)throw Error('Invalid Selector: "'+sel+'"');if(f){i.length&&this.multiToken();if("id"===n){l=d.get.id(null,h[e]);continue}else if("child"=== n||"sibling"===n)e=" "==h[e+1]?e+1:e;if(h[e+1]&&" "!=h[e+1]&&">"!=h[e+1]&&"+"!=h[e+1]){i.push(h[e]);i.push(n);f=!1;continue}l=this.context_loop(function(a){return d.get[n](a,h[e])});i=[]}else i.push(h[e]),i.push(n);f=h[e+1]&&" "!=h[e+1]&&">"!=h[e+1]&&"+"!=h[e+1]?!1:!0}i.length&&this.multiToken();return l}}})();