/* 
* Avac CSS Selector Engine. 
* Created by LGforum @ AvacWeb (avacweb.com)
* AvacWeb Copyright 2011-2012
* All Right Reserved.
* No unauthorized distrubution or copying.
*/
(function(){Array.indexOf||(Array.prototype.indexOf=function(i){for(var c=0,l=this.length;c<l;c++)if(this[c]===i)return c;return-1});window.$avac=function(i,c,l,q){if(i&&!(i==""||i==" ")){!q&&i.indexOf("#")!=-1&&(i=i.substring(i.lastIndexOf("#")));if(c){typeof c==="string"&&(c=$avac(c));var n=typeof c==="object"?"concat"in c?c:"tagName"in c?[c]:Array.prototype.slice.call(c):[document]}else n=[document];var h=i.match(RegExp(/(?:#[^\>\+\.\s\[:]+)|(?:\.[^\>\+\.\s\[:]+)/.source+"|"+/(?:\[\w+(?:[\$\*\^!]?=["'][\w\s]+["'])?\])/.source+ "|"+/(?:[\>\+])|\w+|\s|(?::[\w-]+(?:\([^\)]+\))?)/.source,"g")),f=this,c=true,m=n,k=[],p;if(!/.*:(?:not|has)\(.*/.test(i)&&document.querySelectorAll){for(var l=[],c=0,s=n.length;c<s;c++)l=l.concat(Array.prototype.slice.call(n[c].querySelectorAll(i)));return l}if(l&&l.length==4){orderStr=l.join("|").replace(".","class").replace("[","attr").replace("t","tag").replace(":","pseudo");p=orderStr.split("|");p.unshift("child","sibling")}else p=["child","sibling","class","tag","pseudo","attr"];this.possibles= {id:/^#[^\>\+\.\s\[:]+$/,"class":/^\.[^\>\+\.\s\[:]+$/,tag:/^[^\>\+\.\s\[:="']+$/,child:/^\>$/,attr:/^(?:\[\w+(?:[\$\*\^!]?=["'][\w\s]+["'])?\])$/,sibling:/^\+$/,pseudo:/^:(?:(?:first|last|only(?:-of-type|-child))|empty|(?:not|has|contains)\(.*\))$/};this.identify=function(a){for(var b in f.possibles)if(f.possibles[b].test(a))return b;return false};this.byClass=function(a,b){if(a.getElementsByClassName)return Array.prototype.slice.call(a.getElementsByClassName(b));for(var d=a.all?a.all:a.getElementsByTagName("*"), g=[],j=RegExp("(^|\\s)"+b+"(\\s|$)"),c=0,f=d.length;c<f;c++)j.test(d[c].className)&&g.push(d[c]);return g};this.byAttr=function(a,b,d){for(var g=[],j=a.all?a.all:a.getElementsByTagName("*"),c=b.value,b=b.name,j=b==="href"?a.getElementsByTagName("a"):b==="name"?a.getElementsByName?c?a.getElementsByName(c):j:j:j,a=0,c=j.length;a<c;a++){var f=j[a].getAttribute(b);f&&d(f)&&g.push(j[a])}return g};this.attrParse=function(a){var a=a.replace(/^\[/,"").replace(/\]$/,""),b=a.match(/^\w+/)[0],d=false,g=false; if(/^\w+[\$\^\*!]?=/.test(a)){d=a.match(/[\^\$\*!]?=/)[0];g=a.substring(a.indexOf(d)+d.length);g=g.replace(/^['"]/,"").replace(/['"]$/,"")}return{name:b,condition:d,value:g}};this.getAttrFn=function(a){return a.condition==="="?function(b){return b===a.value}:a.condition==="^="?function(b){return b.indexOf(a.value)===0}:a.condition==="$="?function(b){return RegExp(a.value+"$").test(b)}:a.condition==="*="?function(b){return b.indexOf(a.value)!=-1}:a.condition==="!="?function(b){return b!=a.value}:function(){return false}}; this.get={id:function(a,b){return[document.getElementById(b.substr(1))]},"class":function(a,b){return f.byClass(a,b.substr(1))},tag:function(a,b){return Array.prototype.slice.call(a.getElementsByTagName(b))},attr:function(a,b){var d=f.attrParse(b),g;g=d.condition&&d.value?g=f.getAttrFn(d):g=function(){return true};return f.byAttr(a,d,g)},child:function(a){return a.firstChild?Array.prototype.slice.call(a.childNodes):[]},sibling:function(a){for(;a=a.nextSibling;)if(a.nodeType==1)return[a];return[]}, pseudo:function(a,b){origsel=b=b.substr(1);if(/(?:has|not)\(.*\)/.test(b)){b=b.substring(0,b.indexOf("("));origsel=origsel.replace(/(?:has|not)\((.*)\)/,"$1").replace(/^['"]/,"").replace(/['"]$/,"")}return f.pseudo_get[b](a,origsel)}};this.context_loop=function(a){for(var b=n,d=n.length,g=[],c=0;c<d;c++)b[c].nodeType!=1&&b[c].nodeType!=9||(g=g.concat(a(b[c])));return g};this.filter_function=function(a){for(var b=m,d=[],g=b.length,c=0;c<g;c++)b[c].nodeType!=1&&b[c].nodeType!=9||a(b[c])&&d.push(b[c]); return d};this.filter={"class":function(a){var b=RegExp("(^|\\s)"+a.substr(1)+"(\\s|$)");return f.filter_function(function(a){return b.test(a.className)})},tag:function(a){return f.filter_function(function(b){return b.tagName.toLowerCase()===a.toLowerCase()})},attr:function(a){var b=f.attrParse(a),d;d=b.condition&&b.value?d=f.getAttrFn(b):function(){return true};return f.filter_function(function(a){return a.getAttribute(b.name)?d(a.getAttribute(b.name)):false})},sibling:function(){return f.filter_function(function(a){for(a= a.previousSibling;a&&a.nodeType!=1;)a=a.previousSibling;return m.indexOf(a)!=-1})},pseudo:function(a){origsel=a=a.substr(1);if(/(?:has|not)\(.*\)/.test(a)){a=a.substring(0,a.indexOf("("));origsel=origsel.replace(/(?:has|not)\((.*)\)/,"$1").replace(/^['"]/,"").replace(/['"]$/,"")}return f.filter_function(function(b){return f.pseudo_filter[a](b,origsel)})}};this.pseudo_filter={"first-child":function(a){for(;a=a.previousSibling;)if(a.nodeType==1)return false;return true},"last-child":function(a){for(;a= a.nextSibling;)if(a.nodeType==1)return false;return true},"only-child":function(a){for(var b=a.parentNode.childNodes,d=0,c=b.length;d<c;d++)if(b[d].nodeType==1&&b[d]!=a)return false;return true},has:function(a,b){return $avac(b,a,0,q).length>0},not:function(a,b){return $avac(b,a.parentNode,0,q).indexOf(a)===-1}};this.pseudo_get={"first-child":function(a){for(var a=a.all?a.all:a.getElementsByTagName("*"),b=[],d=0,c=a.length;d<c;d++)f.pseudo_filter["first-child"](a[d])&&b.push(a[d]);return b},"last-child":function(a){for(var a= a.all?a.all:a.getElementsByTagName("*"),b=[],d=0,c=a.length;d<c;d++)f.pseudo_filter["last-child"](a[d])&&b.push(a[d]);return b},"only-child":function(a){for(var a=a.all?a.all:a.getElementsByTagName("*"),b=[],d=0,c=a.length;d<c;d++)f.pseudo_filter["only-child"](a[d])&&b.push(a[d]);return b},has:function(a,b){for(var d=a.all?a.all:a.getElementsByTagName("*"),c=[],j=0,e=d.length;j<e;j++)f.pseudo_filter.has(d[j],b)&&c.push(d[j]);return c},not:function(a,b){for(var d=a.all?a.all:a.getElementsByTagName("*"), c=[],e=0,h=d.length;e<h;e++)f.pseudo_filter.not(d[e],b)&&c.push(d[e]);return c}};var r=this.identify(i);if(r)return this.context_loop(function(a){return this.get[r](a,i)});this.multiToken=function(){for(var a=[],b,c=0,e=p.length;c<e;c++)for(;k.indexOf(p[c],1)!=-1;){b=k.indexOf(p[c],1);a.push(k[b-1]);a.push(k[b]);k[b]=k[b]=null}m=f.context_loop(function(b){return f.get[a[1]](b,a[0])});b=2;for(c=a.length;b<c;b++){e=a[b];b++;m=this.filter[a[b]](e)}n=m};for(var e=0,l=h.length;e<l;e++){n=m;if(h[e]==" ")c= true;else{var o=this.identify(h[e]);if(!o)throw Error('Invalid Selector: "'+sel+'"');if(c){k.length&&this.multiToken();if(o==="id"){m=f.get.id(null,h[e]);continue}else if(o==="child"||o==="sibling")e=h[e+1]==" "?e+1:e;if(h[e+1]&&h[e+1]!=" "&&h[e+1]!=">"&&h[e+1]!="+"){k.push(h[e]);k.push(o);c=false;continue}m=this.context_loop(function(a){return f.get[o](a,h[e])});k=[]}else{k.push(h[e]);k.push(o)}c=h[e+1]&&h[e+1]!=" "&&h[e+1]!=">"&&h[e+1]!="+"?false:true}}k.length&&this.multiToken();return m}}})();