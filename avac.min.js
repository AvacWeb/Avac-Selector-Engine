/* 
* Avac CSS Selector Engine. 
* Created by LGforum @ AvacWeb (avacweb.com)
* AvacWeb Copyright 2011-2012
* All Right Reserved.
* No unauthorized distrubution or copying.
*/
(function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(e){for(var c=0,m=this.length;c<m;c++)if(this[c]===e)return c;return-1});var s;try{Array.prototype.slice.call(document.getElementByTagName("head")),s=function(e){return Array.prototype.slice.call(e)}}catch(w){s=function(e){if(e instanceof Object)return Array.prototype.slice.call(e);l=e.length;ret=[];for(i=0;i<l;i++)ret.push(e[i]);return ret}}window.$avac=function(e,c,m,t){if(e&&!(e==""||e==" ")){!t&&e.indexOf("#")!=-1&&(e=e.substring(e.lastIndexOf("#")));this.Slice=s;if(c){typeof c==="string"&&(c=$avac(c));var p=typeof c==="object"?"concat"in c?c:"tagName"in c?[c]:this.Slice(c):[document]}else p=[document];var j=e.match(RegExp(/(?:#[^\>\+\.\s\[:]+)|(?:\.[^\>\+\.\s\[:]+)/.source+"|"+/(?:\[\w+(?:[\$\*\^!]?=["'][\w\s]+["'])?\])/.source+"|"+/(?:[\>\+])|\w+|\s|(?::[\w-]+(?:\([^\)]+\))?)/.source,"g")),f=this,c=true,n=p,k=[],r;if(!/.*:(?:not|has)\(.*/.test(e)&&document.querySelectorAll){for(var m=[],c=0,v=p.length;c<v;c++)m=m.concat(this.Slice(p[c].querySelectorAll(e)));return m}if(m&&m.length==4){orderStr=m.join("|").replace(".","class").replace("[","attr").replace("t","tag").replace(":","pseudo");r=orderStr.split("|");r.unshift("child","sibling")}else r=["child","sibling","class","tag","pseudo","attr"];this.possibles={id:/^#[^\>\+\.\s\[:]+$/,"class":/^\.[^\>\+\.\s\[:]+$/,tag:/^[^\>\+\.\s\[:="']+$/,child:/^\>$/,attr:/^(?:\[\w+(?:[\$\*\^!]?=["'][\w\s]+["'])?\])$/,sibling:/^\+$/,pseudo:/^:(?:(?:first|last|only(?:-of-type|-child))|empty|(?:not|has|contains)\(.*\))$/};this.identify=function(a){for(var b in f.possibles)if(f.possibles[b].test(a))return b;return false};this.byClass=function(a,b){if(a.getElementsByClassName)return f.Slice(a.getElementsByClassName(b));for(var d=a.all?a.all:a.getElementsByTagName("*"),h=[],o=RegExp("(^|\\s)"+b+"(\\s|$)"),c=0,e=d.length;c<e;c++)o.test(d[c].className)&&h.push(d[c]);return h};this.byAttr=function(a,b,d){for(var h=[],o=a.all?a.all:a.getElementsByTagName("*"),c=b.value,b=b.name,o=b==="href"?a.getElementsByTagName("a"):b==="name"?a.getElementsByName?c?a.getElementsByName(c):o:o:o,a=0,c=o.length;a<c;a++){var f=o[a].getAttribute(b);f&&d(f)&&h.push(o[a])}return h};this.attrParse=function(a){var a=a.replace(/^\[/,"").replace(/\]$/,""),b=a.match(/^\w+/)[0],d=false,h=false;if(/^\w+[\$\^\*!]?=/.test(a)){d=a.match(/[\^\$\*!]?=/)[0];h=a.substring(a.indexOf(d)+d.length);h=h.replace(/^['"]/,"").replace(/['"]$/,"")}return{name:b,condition:d,value:h}};this.getAttrFn=function(a){return a.condition==="="?function(b){return b===a.value}:a.condition==="^="?function(b){return b.indexOf(a.value)===0}:a.condition==="$="?function(b){return RegExp(a.value+"$").test(b)}:a.condition==="*="?function(b){return b.indexOf(a.value)!=-1}:a.condition==="!="?function(b){return b!=a.value}:function(){return false}};this.get={id:function(a,b){return[document.getElementById(b.substr(1))]},"class":function(a,b){return f.byClass(a,b.substr(1))},tag:function(a,b){return f.Slice(a.getElementsByTagName(b))},attr:function(a,b){var d=f.attrParse(b),h;h=d.condition&&d.value?h=f.getAttrFn(d):h=function(){return true};return f.byAttr(a,d,h)},child:function(a){return a.firstChild?this.Slice(a.childNodes):[]},sibling:function(a){for(;a=a.nextSibling;)if(a.nodeType==1)return[a];return[]},pseudo:function(a,b){origsel=b=b.substr(1);if(/(?:has|not)\(.*\)/.test(b)){b=b.substring(0,b.indexOf("("));origsel=origsel.replace(/(?:has|not)\((.*)\)/,"$1").replace(/^['"]/,"").replace(/['"]$/,"")}return f.pseudo_get[b](a,origsel)}};this.context_loop=function(a){for(var b=p,d=p.length,h=[],c=0;c<d;c++)b[c].nodeType!=1&&b[c].nodeType!=9||(h=h.concat(a(b[c])));return h};this.filter_function=function(a){for(var b=n,d=[],h=b.length,c=0;c<h;c++)b[c].nodeType!=1&&b[c].nodeType!=9||a(b[c])&&d.push(b[c]);return d};this.filter={"class":function(a){var b=RegExp("(^|\\s)"+a.substr(1)+"(\\s|$)");return f.filter_function(function(a){return b.test(a.className)})},tag:function(a){return f.filter_function(function(b){return b.tagName.toLowerCase()===a.toLowerCase()})},attr:function(a){var b=f.attrParse(a),d;d=b.condition&&b.value?d=f.getAttrFn(b):function(){return true};return f.filter_function(function(a){return a.getAttribute(b.name)?d(a.getAttribute(b.name)):false})},sibling:function(){return f.filter_function(function(a){for(a=a.previousSibling;a&&a.nodeType!=1;)a=a.previousSibling;return n.indexOf(a)!=-1})},pseudo:function(a){origsel=a=a.substr(1);if(/(?:has|not)\(.*\)/.test(a)){a=a.substring(0,a.indexOf("("));origsel=origsel.replace(/(?:has|not)\((.*)\)/,"$1").replace(/^['"]/,"").replace(/['"]$/,"")}return f.filter_function(function(b){return f.pseudo_filter[a](b,origsel)})}};this.pseudo_filter={"first-child":function(a){for(;a=a.previousSibling;)if(a.nodeType==1)return false;return true},"last-child":function(a){for(;a=a.nextSibling;)if(a.nodeType==1)return false;return true},"only-child":function(a){for(var b=a.parentNode.childNodes,d=0,c=b.length;d<c;d++)if(b[d].nodeType==1&&b[d]!=a)return false;return true},has:function(a,b){return $avac(b,a,0,t).length>0},not:function(a,b){return $avac(b,a.parentNode,0,t).indexOf(a)===-1}};this.pseudo_get={"first-child":function(a){for(var a=a.all?a.all:a.getElementsByTagName("*"),b=[],d=0,c=a.length;d<c;d++)f.pseudo_filter["first-child"](a[d])&&b.push(a[d]);return b},"last-child":function(a){for(var a=a.all?a.all:a.getElementsByTagName("*"),b=[],d=0,c=a.length;d<c;d++)f.pseudo_filter["last-child"](a[d])&&b.push(a[d]);return b},"only-child":function(a){for(var a=a.all?a.all:a.getElementsByTagName("*"),b=[],d=0,c=a.length;d<c;d++)f.pseudo_filter["only-child"](a[d])&&b.push(a[d]);return b},has:function(a,b){for(var d=a.all?a.all:a.getElementsByTagName("*"),c=[],e=0,g=d.length;e<g;e++)f.pseudo_filter.has(d[e],b)&&c.push(d[e]);return c},not:function(a,b){for(var d=a.all?a.all:a.getElementsByTagName("*"),c=[],e=0,g=d.length;e<g;e++)f.pseudo_filter.not(d[e],b)&&c.push(d[e]);return c}};var u=this.identify(e);if(u)return this.context_loop(function(a){return this.get[u](a,e)});this.multiToken=function(){for(var a=[],b,c=0,e=r.length;c<e;c++)for(;k.indexOf(r[c],1)!=-1;){b=k.indexOf(r[c],1);a.push(k[b-1]);a.push(k[b]);k[b]=k[b]=null}n=f.context_loop(function(b){return f.get[a[1]](b,a[0])});b=2;for(c=a.length;b<c;b++){e=a[b];b++;n=this.filter[a[b]](e)}p=n};for(var g=0,m=j.length;g<m;g++){p=n;if(j[g]==" ")c=true;else{var q=this.identify(j[g]);if(!q)throw Error('Invalid Selector: "'+sel+'"');if(c){k.length&&this.multiToken();if(q==="id"){n=f.get.id(null,j[g]);continue}else if(q==="child"||q==="sibling")g=j[g+1]==" "?g+1:g;if(j[g+1]&&j[g+1]!=" "&&j[g+1]!=">"&&j[g+1]!="+"){k.push(j[g]);k.push(q);c=false;continue}n=this.context_loop(function(a){return f.get[q](a,j[g])});k=[]}else{k.push(j[g]);k.push(q)}c=j[g+1]&&j[g+1]!=" "&&j[g+1]!=">"&&j[g+1]!="+"?false:true}}k.length&&this.multiToken();return n}}})();