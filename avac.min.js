/* 
* Avac CSS Selector Engine. 
* Created by LGforum @ AvacWeb (avacweb.com)
* AvacWeb Copyright 2011-2012
* All Right Reserved.
* No unauthorized distrubution or copying.
*/

(function(){window.$avac=function(j,g,k,q){if(j&&!(""==j||" "==j)){!q&&-1!=j.indexOf("#")&&(j=j.substring(j.lastIndexOf("#")));if(g){"string"===typeof g&&(g=$avac(g));var n="object"===typeof g?"concat"in g?g:"tagName"in g?[g]:Array.prototype.slice.call(g):[document]}else n=[document];var h=j.match(RegExp(/(?:#[^\>\+\.\s\[:]+)|(?:\.[^\>\+\.\s\[:]+)/.source+"|"+/(?:\[\w+(?:[\$\*\^!]?=["'][\w\s]+["'])?\])/.source+"|"+/(?:[\>\+])|\w+|\s|(?::[\w-]+(?:\([^\)]+\))?)/.source,"g")),d=this,g=!0,l=n,i=[],p; if(!/:not\(|:has\(/.test(j)&&document.querySelectorAll){k=[];g=0;for(q=n.length;g<q;g++)k=k.concat(Array.prototype.slice.call(n[g].querySelectorAll(j)));return k}k&&4==k.length?(orderStr=k.join("|").replace(".","class").replace("[","attr").replace("t","tag").replace(":","pseudo"),p=orderStr.split("|"),p.unshift("child","sibling")):p="child,sibling,class,tag,pseudo,attr".split(",");this.possibles={id:/^#[^\>\+\.\s\[:]+$/,"class":/^\.[^\>\+\.\s\[:]+$/,tag:/^[^\>\+\.\s\[:="']+$/,child:/^\>$/,attr:/^(?:\[\w+(?:[\$\*\^!]?=["'][\w\s]+["'])?\])$/, sibling:/^\+$/,pseudo:/^:(?:(?:first|last|only(?:-of-type|-child))|empty|(?:not|has|contains)\(.*\))$/};this.identify=function(a){for(var b in d.possibles)if(d.possibles[b].test(a))return b;return false};this.byClass=function(a,b){if(a.getElementsByClassName)return Array.prototype.slice.call(a.getElementsByClassName(b));for(var c=a.all?a.all:a.getElementsByTagName("*"),e=[],m=RegExp("(^|\\s)"+b+"(\\s|$)"),d=0,f=c.length;d<f;d++)m.test(c[d].className)&&e.push(c[d]);return e};this.byAttr=function(a, b,c){for(var e=[],m=a.all?a.all:a.getElementsByTagName("*"),d=b.value,b=b.name,m=b==="href"?a.getElementsByTagName("a"):b==="name"?a.getElementsByName?d?a.getElementsByName(d):m:m:m,a=0,d=m.length;a<d;a++){var f=m[a].getAttribute(b);f&&c(f)&&e.push(m[a])}return e};this.attrParse=function(a){var a=a.replace(/^\[/,"").replace(/\]$/,""),b=a.match(/^\w+/)[0],c=false,e=false;if(/^\w+[\$\^\*!]?=/.test(a)){c=a.match(/[\^\$\*!]?=/)[0];e=a.substring(a.indexOf(c)+c.length);e=e.replace(/^['"]/,"").replace(/['"]$/, "")}return{name:b,condition:c,value:e}};this.getAttrFn=function(a){return a.condition==="="?function(b){return b===a.value}:a.condition==="^="?function(b){return b.indexOf(a.value)===0}:a.condition==="$="?function(b){return RegExp(a.value+"$").test(b)}:a.condition==="*="?function(b){return b.indexOf(a.value)!=-1}:a.condition==="!="?function(b){return b!=a.value}:function(){return false}};this.get={id:function(a,b){return[document.getElementById(b.substr(1))]},"class":function(a,b){return d.byClass(a, b.substr(1))},tag:function(a,b){return Array.prototype.slice.call(a.getElementsByTagName(b))},attr:function(a,b){var c=d.attrParse(b),e;e=c.condition&&c.value?e=d.getAttrFn(c):e=function(){return true};return d.byAttr(a,c,e)},child:function(a){return a.firstChild?Array.prototype.slice.call(a.childNodes):[]},sibling:function(a){for(;a=a.nextSibling;)if(a.nodeType==1)return[a];return[]},pseudo:function(a,b){origsel=b=b.substr(1);if(/has|not|contains\(.*\)/.test(b)){b=b.substring(0,b.indexOf("("));origsel= origsel.replace(/(?:has|not|contains)\((.*)\)/,"$1").replace(/^['"]/,"").replace(/['"]$/,"")}return d.pseudo_get[b](a,origsel)}};this.context_loop=function(a){for(var b=n,c=n.length,e=[],d=0;d<c;d++)b[d].nodeType!=1&&b[d].nodeType!=9||(e=e.concat(a(b[d])));return e};this.filter_function=function(a){for(var b=l,c=[],e=b.length,d=0;d<e;d++)b[d].nodeType!=1&&b[d].nodeType!=9||a(b[d])&&c.push(b[d]);return c};this.filter={"class":function(a){var b=RegExp("(^|\\s)"+a.substr(1)+"(\\s|$)");return d.filter_function(function(a){return b.test(a.className)})}, tag:function(a){return d.filter_function(function(b){return b.tagName.toLowerCase()===a.toLowerCase()})},attr:function(a){var b=d.attrParse(a),c;c=b.condition&&b.value?c=d.getAttrFn(b):function(){return true};return d.filter_function(function(a){return a.getAttribute(b.name)?c(a.getAttribute(b.name)):false})},sibling:function(){return d.filter_function(function(a){for(a=a.previousSibling;a&&a.nodeType!=1;)a=a.previousSibling;return l.indexOf(a)!=-1})},pseudo:function(a){origsel=a=a.substr(1);if(/has|not|contains\(.*\)/.test(a)){a= a.substring(0,a.indexOf("("));origsel=origsel.replace(/(?:has|not|contains)\((.*)\)/,"$1").replace(/^['"]/,"").replace(/['"]$/,"")}return d.filter_function(function(b){return d.pseudo_filter[a](b,origsel)})}};this.pseudo_filter={"first-child":function(a){for(;a=a.previousSibling;)if(a.nodeType==1)return false;return true},"last-child":function(a){for(;a=a.nextSibling;)if(a.nodeType==1)return false;return true},"only-child":function(a){for(var b=a.parentNode.childNodes,c=0,d=b.length;c<d;c++)if(b[c].nodeType== 1&&b[c]!=a)return false;return true},has:function(a,b){return $avac(b,a).length>0},not:function(a,b){return $avac(b,a.parentNode).indexOf(a)===-1}};this.pseudo_get={"first-child":function(a){for(var a=a.all?a.all:a.getElementsByTagName("*"),b=[],c=0,e=a.length;c<e;c++)d.pseudo_filter["first-child"](a[c])&&b.push(a[c]);return b},"last-child":function(a){for(var a=a.all?a.all:a.getElementsByTagName("*"),b=[],c=0,e=a.length;c<e;c++)d.pseudo_filter["last-child"](a[c])&&b.push(a[c]);return b},"only-child":function(a){for(var a= a.all?a.all:a.getElementsByTagName("*"),b=[],c=0,e=a.length;c<e;c++)d.pseudo_filter["only-child"](a[c])&&b.push(a[c]);return b},has:function(a,b){for(var c=a.all?a.all:a.getElementsByTagName("*"),e=[],f=0,g=c.length;f<g;f++)d.pseudo_filter.has(c[f],b)&&e.push(c[f]);return e},not:function(a,b){for(var c=a.all?a.all:a.getElementsByTagName("*"),e=[],f=0,g=c.length;f<g;f++)d.pseudo_filter.not(c[f],b)&&e.push(c[f]);return e}};var r=this.identify(j);if(r)return this.context_loop(function(a){return this.get[r](a, j)});this.multiToken=function(){for(var a=[],b,c=0,e=p.length;c<e;c++)for(;i.indexOf(p[c],1)!=-1;){b=i.indexOf(p[c],1);a.push(i[b-1]);a.push(i[b]);i[b]=i[b]=null}l=d.context_loop(function(b){return d.get[a[1]](b,a[0])});b=2;for(c=a.length;b<c;b++){e=a[b];b++;l=this.filter[a[b]](e)}n=l};for(var f=0,k=h.length;f<k;f++)if(n=l," "==h[f])g=!0;else{var o=this.identify(h[f]);if(!o)throw Error('Invalid Selector: "'+sel+'"');if(g){i.length&&this.multiToken();if("id"===o){l=d.get.id(null,h[f]);continue}else if("child"=== o||"sibling"===o)f=" "==h[f+1]?f+1:f;if(h[f+1]&&" "!=h[f+1]&&">"!=h[f+1]&&"+"!=h[f+1]){i.push(h[f]);i.push(o);g=!1;continue}l=this.context_loop(function(a){return d.get[o](a,h[f])});i=[]}else i.push(h[f]),i.push(o);g=h[f+1]&&" "!=h[f+1]&&">"!=h[f+1]&&"+"!=h[f+1]?!1:!0}i.length&&this.multiToken();return l}}})();