/* 
* Avac CSS Selector Engine. 
* Created by LGforum @ AvacWeb (avacweb.com)
* AvacWeb Copyright 2011-2012
* All Right Reserved.
* No unauthorized distrubution or copying.
*/

(function(){var o=function(h,d,j){if(h&&!(""==h||" "==h)){-1!=h.indexOf("#")&&(h=h.substring(h.lastIndexOf("#")));d?("string"===typeof d&&(d=o(d)),"object"===typeof d&&(cur_context="concat"in d?d:"tagName"in d?[d]:Array.prototype.slice.call(d))):cur_context=[document];var e=h.match(/(?:#[^\>\+\.\s\[:]+)|(?:\.[^\>\+\.\s\[:]+)|(?:\[\w+(?:[\$\*\^!]?=["'][\w\s]+["'])?\])|(?:[\>\+])|\w+|\s/g),f=this,d=!0,k=cur_context,g=[],n;if(document.querySelectorAll){for(var j=[],d=0,p=cur_context.length;d<p;d++)j= j.concat(Array.prototype.slice.call(cur_context[d].querySelectorAll(h)));return j}n=j&&3==j.length?["sibling","child",j[0],j[1],j[2]]:["child","sibling","class","tag","attr"];this.possibles={id:/^#[^\>\+\.\s\[:]+$/,"class":/^\.[^\>\+\.\s\[:]+$/,tag:/^[^\>\+\.\s\[:="']+$/,child:/^\>$/,attr:/^(?:\[\w+(?:[\$\*\^!]?=["'][\w\s]+["'])?\])$/,sibling:/^\+$/};this.identify=function(a){for(var b in f.possibles)if(f.possibles[b].test(a))return b;throw Error('Invalid Selector: "'+a+'"');};this.byClass=function(a, b){if(a.getElementsByClassName)return Array.prototype.slice.call(a.getElementsByClassName(b));for(var i=a.getElementsByTagName("*"),m=[],q=RegExp("(^|\\s)"+b+"(\\s|$)"),c=0,d=i.length;c<d;c++)q.test(i[c].className)&&m.push(i[c]);return m};this.byAttr=function(a,b,i){for(var m=[],c=a.all?a.all:a.getElementsByTagName("*"),d=b.value,b=b.name,c=b==="href"?a.getElementsByTagName("a"):b==="name"?a.getElementsByName?d?a.getElementsByName(d):c:c:c,a=0,d=c.length;a<d;a++){var e=c[a].getAttribute(b);e&&i(e)&& m.push(c[a])}return m};this.attrParse=function(a){var a=a.replace(/^\[/,"").replace(/\]$/,""),b=a.match(/^\w+/)[0],i=false,c=false;if(/^\w+[\$\^\*!]?=/.test(a)){i=a.match(/[\^\$\*!]?=/)[0];c=a.substring(a.indexOf(i)+i.length);c=c.replace(/^['"]/,"").replace(/['"]$/,"")}return{name:b,condition:i,value:c}};this.getAttrFn=function(a){return a.condition==="="?function(b){return b===a.value}:a.condition==="^="?function(b){return b.indexOf(a.value)===0}:a.condition==="$="?function(b){return RegExp(a.value+ "$").test(b)}:a.condition==="*="?function(b){return b.indexOf(a.value)!=-1}:a.condition==="!="?function(b){return b!=a.value}:function(){return false}};this.get={id:function(a,b){var c=b.substr(1);return[document.getElementById(c)]},"class":function(a,b){var c=b.substr(1);return f.byClass(a,c)},tag:function(a,b){return Array.prototype.slice.call(a.getElementsByTagName(b))},attr:function(a,b){var c=f.attrParse(b),d;d=c.condition&&c.value?d=f.getAttrFn(c):d=function(){return true};return f.byAttr(a, c,d)},child:function(a){return a.firstChild?Array.prototype.slice.call(a.childNodes):[]},sibling:function(a){for(;a=a.nextSibling;)if(a.nodeType==1)return[a];return[]}};this.context_loop=function(a){for(var b=cur_context,c=cur_context.length,d=[],e=0;e<c;e++)b[e].nodeType!=1&&b[e].nodeType!=9||(d=d.concat(a(b[e])));return d};this.filter_function=function(a){for(var b=k,c=[],d=b.length,e=0,d=b.length;e<d;e++)b[e].nodeType!=1&&b[e].nodeType!=9||a(b[e])&&c.push(b[e]);return c};this.filter={"class":function(a){var b= RegExp("(^|\\s)"+a.substr(1)+"(\\s|$)");return f.filter_function(function(a){return b.test(a.className)})},tag:function(a){return f.filter_function(function(b){return b.tagName.toLowerCase()===a.toLowerCase()})},attr:function(a){var b=f.attrParse(a),c;c=b.condition&&b.value?c=f.getAttrFn(b):function(){return true};return f.filter_function(function(a){return a.getAttribute(b.name)?c(a.getAttribute(b.name)):false})},sibling:function(){return f.filter_function(function(a){for(a=a.previousSibling;a.nodeType!= 1;)a=a.previousSibling;return k.indexOf(a)!=-1})}};this.multiToken=function(){for(var a=[],b,c=0,d=n.length;c<d;c++)for(;g.indexOf(n[c],1)!=-1;){b=g.indexOf(n[c],1);a.push(g[b-1]);a.push(g[b]);g[b]=g[b]=null}k=f.context_loop(function(b){return f.get[a[1]](b,a[0])});b=2;for(c=a.length;b<c;b++){d=a[b];b++;k=this.filter[a[b]](d)}cur_context=k};for(var c=0,h=e.length;c<h;c++)if(cur_context=k," "==e[c])d=!0;else{var l=this.identify(e[c]);if(d){g.length&&this.multiToken();if("id"===l){k=f.get.id(null,e[c]); continue}else if("child"===l||"sibling"===l)c=" "==e[c+1]?c+1:c;if(e[c+1]&&" "!=e[c+1]&&">"!=e[c+1]&&"+"!=e[c+1]){g.push(e[c]);g.push(l);d=!1;continue}k=this.context_loop(function(a){return f.get[l](a,e[c])});g=[]}else g.push(e[c]),g.push(l);d=e[c+1]&&" "!=e[c+1]&&">"!=e[c+1]&&"+"!=e[c+1]?!1:!0}g.length&&this.multiToken();return k}};window.$avac=o})();