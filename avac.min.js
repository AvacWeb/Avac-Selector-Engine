/* 
* Avac CSS Selector Engine. 
* Created by LGforum @ AvacWeb (avacweb.com)
* AvacWeb Copyright 2011-2012
* All Right Reserved.
* No unauthorized distrubution or copying.
*/
(function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(d){for(var j=0,m=this.length;j<m;j++)if(this[j]===d)return j;return-1});var s;try{Array.prototype.slice.call(document.getElementByTagName("head")),s=function(d){return Array.prototype.slice.call(d)}}catch(w){s=function(d){if(d instanceof Object)return Array.prototype.slice.call(d);l=d.length;ret=[];for(i=0;i<l;i++)ret.push(d[i]);return ret}}window.$avac=function(d,j){if(d&&!(/^\s+$/.test(d)||d=="")){if(/^#\w+$/.test(d))return[document.getElementById(d.substr(1))];var m=/^[^'"\(]+(#[^\>\+\.\s\[:]+)/;if(m.test(d))var q=d.replace(m,"$1").replace(/^#([^\>\+\.\s\[:]+).*/,"$1"),d=d.replace(m,""),j=document.getElementById(q);this.Slice=s;var o=[document];if(j){typeof j==="string"&&(j=$avac(j));typeof j==="object"&&(o="concat"in j?j:"tagName"in j?[j]:this.Slice(j))}var k=d.match(RegExp(/(?:#[^\>\+\.\s\[:]+)|(?:\.[^\>\+\.\s\[:]+)|(?:\[\w+(?:[\$\*\^!]?=["'][\w\s]+["'])?\])/.source+"|"+/(?:[\>\+])|\w+|\s|(?::[\w-]+(?:\([^\)]+\))?)/.source,"g")),f=this,m=true,p=o,n=[],t=["child","sibling","class","tag","pseudo","attr"];if(!/.*:(?:not|has)\(.*/.test(d)&&document.querySelectorAll){for(var m=[],q=0,u=o.length,q=0,u=o.length;q<u;q++)m=m.concat(this.Slice(o[q].querySelectorAll(d)));return m}this.identify=function(a){var b={id:/^#[^\>\+\.\s\[:]+$/,"class":/^\.[^\>\+\.\s\[:]+$/,tag:/^[^\>\+\.\s\[:="']+$/,child:/^\>$/,attr:/^(?:\[\w+(?:[\$\*\^!]?=["'][\w\s]+["'])?\])$/,sibling:/^\+$/,pseudo:/^:(?:(?:first|last|only(?:-of-type|-child))|empty|(?:not|has|contains)\(.*\))$/},c;for(c in b)if(b[c].test(a))return c;return false};this.byClass=function(a,b){if(a.getElementsByClassName)return f.Slice(a.getElementsByClassName(b));for(var c=a.all?a.all:a.getElementsByTagName("*"),e=[],g=RegExp("(^|\\s)"+b+"(\\s|$)"),d=0,h=c.length;d<h;d++)g.test(c[d].className)&&e.push(c[d]);return e};this.byAttr=function(a,b,c){for(var e=[],g=a.all?a.all:a.getElementsByTagName("*"),d=b.value,b=b.name,g=b==="href"?a.getElementsByTagName("a"):b==="name"?a.getElementsByName?d?a.getElementsByName(d):g:g:g,a=0,d=g.length;a<d;a++){var f=g[a].getAttribute(b);f&&c(f)&&e.push(g[a])}return e};this.attrParse=function(a){var a=a.replace(/^\[/,"").replace(/\]$/,""),b=a.match(/^\w+/)[0],c=false,e=false;if(/^\w+[\$\^\*!]?=/.test(a)){c=a.match(/[\^\$\*!]?=/)[0];e=a.substring(a.indexOf(c)+c.length);e=e.replace(/^['"]/,"").replace(/['"]$/,"")}return{name:b,condition:c,value:e}};this.getAttrFn=function(a){return a.condition==="="?function(b){return b===a.value}:a.condition==="^="?function(b){return b.indexOf(a.value)===0}:a.condition==="$="?function(b){return RegExp(a.value+"$").test(b)}:a.condition==="*="?function(b){return b.indexOf(a.value)!=-1}:a.condition==="!="?function(b){return b!=a.value}:function(){return false}};this.getElems={id:function(a,b){return[document.getElementById(b.substr(1))]},"class":function(a,b){return f.byClass(a,b.substr(1))},tag:function(a,b){return f.Slice(a.getElementsByTagName(b))},attr:function(a,b){var c=f.attrParse(b),e;e=c.condition&&c.value?f.getAttrFn(c):function(){return true};return f.byAttr(a,c,e)},child:function(a){return a.firstChild?f.Slice(a.childNodes):[]},sibling:function(a){if("nextElementSibling"in a)return a.nextElementSibling||[];for(;a=a.nextSibling;)if(a.nodeType==1)return[a];return[]},pseudo:function(a,b){origsel=b=b.substr(1);if(/(?:has|not)\(.*\)/.test(b)){b=b.substring(0,b.indexOf("("));origsel=origsel.replace(/^(?:has|not)\((.*)\)$/,"$1").replace(/(^['"])|(['"]$)/,"")}return f.pseudo_get[b](a,origsel)}};this.context_loop=function(a){for(var b=o,c=o.length,e=[],g=0;g<c;g++)b[g].nodeType!=1&&b[g].nodeType!=9||(e=e.concat(a(b[g])));return e};this.filter_function=function(a){for(var b=p,c=[],e=b.length,g=0;g<e;g++)b[g].nodeType!=1&&b[g].nodeType!=9||a(b[g])&&c.push(b[g]);return c};this.filters={"class":function(a){var b=RegExp("(^|\\s)"+a.substr(1)+"(\\s|$)");return f.filter_function(function(a){return b.test(a.className)})},tag:function(a){return f.filter_function(function(b){return b.tagName.toLowerCase()===a.toLowerCase()})},attr:function(a){var b=f.attrParse(a),c=b.condition&&b.value?f.getAttrFn(b):function(){return true};return f.filter_function(function(a){return a.getAttribute(b.name)?c(a.getAttribute(b.name)):false})},sibling:function(){return f.filter_function(function(a){for(a=a.previousElementSibling||a.previousSibling;a&&a.nodeType!=1;)a=a.previousSibling;return p.indexOf(a)!=-1})},pseudo:function(a){origsel=a=a.substr(1);if(/(?:has|not)\(.*\)/.test(a)){a=a.substring(0,a.indexOf("("));origsel=origsel.replace(/(?:has|not)\((.*)\)/,"$1").replace(/^['"]/,"").replace(/['"]$/,"")}return f.filter_function(function(b){return f.pseudo_filter[a](b,origsel)})}};this.pseudo_filters={"first-child":function(a){if(a.previousElementSibling)return false;for(;a=a.previousSibling;)if(a.nodeType==1)return false;return true},"last-child":function(a){if(a.nextElementSibling)return false;for(;a=a.nextSibling;)if(a.nodeType==1)return false;return true},"only-child":function(a){if(a.previousElementSibling||a.nextElementSibling)return false;for(var b=a.parentNode.childNodes,c=0,e=b.length;c<e;c++)if(b[c].nodeType==1&&b[c]!=a)return false;return true},has:function(a,b){return $avac(b,a).length>0},not:function(a,b){return $avac(b,a.parentNode).indexOf(a)===-1}};this.pseudo_get={"first-child":function(a){for(var a=a.all?a.all:a.getElementsByTagName("*"),b=[],c=0,e=a.length;c<e;c++)f.pseudo_filter["first-child"](a[c])&&b.push(a[c]);return b},"last-child":function(a){for(var a=a.all?a.all:a.getElementsByTagName("*"),b=[],c=0,e=a.length;c<e;c++)f.pseudo_filter["last-child"](a[c])&&b.push(a[c]);return b},"only-child":function(a){for(var a=a.all?a.all:a.getElementsByTagName("*"),b=[],c=0,e=a.length;c<e;c++)f.pseudo_filter["only-child"](a[c])&&b.push(a[c]);return b},has:function(a,b){for(var c=a.all?a.all:a.getElementsByTagName("*"),e=[],g=0,d=c.length;g<d;g++)f.pseudo_filter.has(c[g],b)&&e.push(c[g]);return e},not:function(a,b){for(var c=a.all?a.all:a.getElementsByTagName("*"),e=[],d=0,h=c.length;d<h;d++)f.pseudo_filter.not(c[d],b)&&e.push(c[d]);return e}};var v=this.identify(d);if(v)return this.context_loop(function(a){return this.getElems[v](a,d)});this.multiToken=function(){for(var a=[],b,c=0,d=t.length;c<d;c++)for(;n.indexOf(t[c],1)!=-1;){b=n.indexOf(t[c],1);a.push(n[b-1]);a.push(n[b]);n[b]=n[b]=null}p=f.context_loop(function(b){return f.getElems[a[1]](b,a[0])});b=2;for(c=a.length;b<c;b++){d=a[b];b++;p=this.filters[a[b]](d)}o=p};for(var h=0,q=k.length;h<q;h++){o=p;if(k[h]==" ")m=true;else{var r=this.identify(k[h]);if(!r)throw Error('Invalid Selector: "'+sel+'"');if(m){n.length&&this.multiToken();if(r==="id"){p=f.getElems.id(null,k[h]);continue}else if(r==="child"||r==="sibling")h=k[h+1]==" "?h+1:h;if(k[h+1]&&k[h+1]!=" "&&k[h+1]!=">"&&k[h+1]!="+"){n.push(k[h]);n.push(r);m=false;continue}p=this.context_loop(function(a){return f.getElems[r](a,k[h])});n=[]}else{n.push(k[h]);n.push(r)}m=k[h+1]&&k[h+1]!=" "&&k[h+1]!=">"&&k[h+1]!="+"?false:true}}n.length&&this.multiToken();return p}}})();